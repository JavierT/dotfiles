#!/bin/bash

# Based on https://gist.github.com/ctemplin/3c626af969c67e51d805

id=$(xprop -root | awk '/_NET_ACTIVE_WINDOW\(WINDOW\)/{print $NF}')
class_string=$(xprop -id $id | awk '/WM_CLASS\(STRING\)/' | cut -d'=' -f2 | cut -d',' -f1)
if [ $class_string != '"urxvt"' ]
    then
        pid=$(xprop -id $id | awk '/_NET_WM_PID\(CARDINAL\)/' | cut -d'=' -f2)
        cwd=$(pwdx $pid | cut -d':' -f2 | cut -d' ' -f2)
    else
        name=$(xprop -id $id | awk '/_NET_WM_NAME/' | cut -d'"' -f2 | cut -d" " -f4 );
        name=$(echo "$name" | sed "s|~|$HOME|" )
        cwd=$name
fi

cwd=${cwd:-$(echo $HOME)}
urxvtc -cd $cwd
