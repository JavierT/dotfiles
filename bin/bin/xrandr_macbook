#!/bin/bash
# Taken from http://www.jejik.com/articles/2008/10/setting_up_dual_monitors_system-wide_with_xrandr_on_debian_lenny/

CONNECTED_DP=`xrandr | grep " connected" | sed -n 's/DisplayPort-\([0-9]\).*/\1/p'`
if [ -n "$CONNECTED_DP" ]; then
    export XRANDR_PRIMARY=DisplayPort-$CONNECTED_DP
    export XRANDR_SECONDARY=LVDS-0
    # External monitor is connected.
    # There's a bug or something in my MBP that I need to set a lower resolution
    # prior to using `auto` or the right resolution, for it to work (when on
    # dualhead).
    xrandr --output LVDS-0 --mode 1400x1050 --output $XRANDR_PRIMARY --primary --auto --right-of LVDS-0
    xrandr --output LVDS-0 --auto --output $XRANDR_PRIMARY --primary --auto --right-of LVDS-0
    if [ $? -ne 0 ]; then
        # Something went wrong. Autoconfigure the internal monitor and disable
        # the external one
        xrandr --output LVDS-0 --mode auto --output DisplayPort-$FIRST_DP --off
        export XRANDR_PRIMARY=LVDS-0
        export XRANDR_SECONDARY=LVDS-0
    fi
fi

# MBP ICC color profile on display 0
/usr/bin/xcalib -d :0 ~/.colorprofiles/mbp.icc
